# netcore-OtgToken
.Net Core Libruary for authorized http-interaction between microservices using a one-time token with  1-2 minutes lifetime

Operating Systems on which microservices are located must be synchronized by time.

#### Adding to DI-service

```csharp
public void ConfigureServices(IServiceCollection services)
{
    services.AddOtgToken();
}

// or it's the same
public void ConfigureServices(IServiceCollection services)
{
    services.AddSingleton<IOtgToken, OtgToken>();
    services.AddMemoryCache(); // using in ValidateOtgTokenAttribute
}
```

#### Http-interaction between microservices

client-microservice

```csharp
public async Task<MyClass> GetData()
{
    var headers = OtgToken.GetOtgTokenHeaders("client-microservice");
    // https://github.com/dnartub/netcore-httpRequests
    return await HttpRequests.GetAsync<MyClass>(_url, headers);
}
```

host-microservice

```csharp
[HttpGet]
[ValidateOtgToken(Key = "client-microservice")]
public async Task<IActionResult> Get()
{
    var result = new ObjectResult(new MyClass())
    {
        StatusCode = StatusCodes.Status200OK
    };

    return result;
}
```
Client generate Http-headers for http-request
* "Otg-Authenticate-Key" is equal client application name
* "Otg-Authenticate-RequestId" is new Guid 
* "Otg-Authenticate-Token" is generated by DateTime.Now() and publickey which is  concatenation of "Otg-Authenticate-Key" and "Otg-Authenticate-RequestId"

Action filter attribute checks for headers: 
* "Otg-Authenticate-Key" - must be equal `Key` property
* "Otg-Authenticate-RequestId" - not processed before. Used to exclude request generated by sniffers
* "Otg-Authenticate-Token" - validate by DateTime.Now() and publickey which is concatenation of "Otg-Authenticate-Key" and "Otg-Authenticate-RequestId"


#### Remark:

For unique hashing algorithm you must modify some functions in OtgToken class: GetTemplate,  GetDigits, GetHash


